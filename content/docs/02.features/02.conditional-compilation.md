---
title: 条件编译
description: 了解如何使用条件编译实现多平台差异化配置。
---

## 什么是条件编译？

UniApp 支持多端发布（H5、微信小程序、App 等），不同平台可能需要不同的页面配置。uni-pages 提供了优雅的条件编译语法，让你在一处配置中定义多平台差异。

## 基础语法

在 `definePageMeta` 或 `pages.config.ts` 中，使用对象字面量进行条件编译：

```vue
<script setup lang="ts">
definePageMeta({
  style: {
    navigationBarTitleText: {
      'h5': 'H5 标题',
      'mp-weixin': '微信小程序标题',
      'app-plus': 'App 标题',
      'default': '默认标题',
    },
  },
})
</script>
```

## 组合条件

使用 `||` 表示「或」关系，匹配多个平台：

```vue
<script setup lang="ts">
definePageMeta({
  style: {
    navigationBarTitleText: {
      'mp-weixin || mp-alipay': '小程序标题',
      'h5 || app-plus': 'Web/App 标题',
      'default': '默认标题',
    },
  },
})
</script>
```

## 在 pages.config.ts 中使用

全局配置同样支持条件编译：

```ts [src/pages.config.ts]
import { defineConfig } from 'uni-pages'

export default defineConfig({
  globalStyle: {
    navigationBarTextStyle: 'black',
    navigationBarTitleText: {
      'h5': 'uni-app H5',
      'mp-weixin': 'uni-app 小程序',
      'app-plus': 'uni-app',
      'default': 'uni-app',
    },
    navigationBarBackgroundColor: '#F8F8F8',
  },
})
```

构建时，uni-pages 会根据目标平台解析条件编译，生成对应的 `pages.json`。

例如，构建微信小程序时：

```json
{
  "globalStyle": {
    "navigationBarTextStyle": "black",
    "navigationBarTitleText": "uni-app 小程序",
    "navigationBarBackgroundColor": "#F8F8F8"
  }
}
```

构建 H5 时：

```json
{
  "globalStyle": {
    "navigationBarTextStyle": "black",
    "navigationBarTitleText": "uni-app H5",
    "navigationBarBackgroundColor": "#F8F8F8"
  }
}
```


## 支持的平台标识

| 平台标识      | 说明                   |
|---------------|------------------------|
| `h5/web`      | H5 网页                |
| `app-plus`    | App（iOS/Android）     |
| `mp-weixin`   | 微信小程序             |
| `mp-alipay`   | 支付宝小程序           |
| `mp-baidu`    | 百度小程序             |
| `mp-toutiao`  | 抖音小程序             |
| `mp-qq`       | QQ 小程序              |
| `mp-kuaishou` | 快手小程序             |
| `mp-jd`       | 京东小程序             |
| `mp-lark`     | 飞书小程序             |
| `default`     | 默认值（未匹配时使用） |


## 匹配优先级

当多个条件可能匹配时，按以下优先级选择：

1. **精确匹配**：单个平台标识（如 `mp-weixin`）
2. **组合匹配**：多个平台组合（如 `mp-weixin || mp-alipay`）
3. **默认值**：`default`

```ts
{
  navigationBarTitleText: {
    'mp-weixin': '微信专属',           // 优先级 1
    'mp-weixin || mp-alipay': '小程序', // 优先级 2
    'default': '默认',                  // 优先级 3
  },
}
```

## 完整示例

```vue
<script setup lang="ts">
definePageMeta({
  style: {
    // 不同平台使用不同标题
    navigationBarTitleText: {
      'h5': '网页版',
      'mp-weixin': '微信版',
      'app-plus': 'App 版',
      'default': '应用',
    },
    // 不同平台使用不同背景色
    navigationBarBackgroundColor: {
      'h5': '#ffffff',
      'mp-weixin': '#07C160',
      'app-plus': '#007AFF',
      'default': '#F8F8F8',
    },
    // 根据背景色调整文字颜色
    navigationBarTextStyle: {
      'h5': 'black',
      'mp-weixin || app-plus': 'white',
      'default': 'black',
    },
  },
})
</script>
```
